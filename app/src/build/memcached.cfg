[buildout]
extends =
    common.cfg
unzip = true
parts += 
    libevent
    memcached
    libmemcached
    pylibmc
find-links = 
    ${config:pypi-urls}
versions = versions

[versions]
pylibmc = 1.5.0

[libevent]
recipe = hexagonit.recipe.cmmi
url = https://github.com/libevent/libevent/releases/download/release-2.1.12-stable/libevent-2.1.12-stable.tar.gz
md5sum = b5333f021f880fe76490d8a799cd79f4
prefix = ${buildout:parts-directory}/opt

[memcached]
recipe = hexagonit.recipe.cmmi
url = http://www.memcached.org/files/memcached-1.6.12.tar.gz
md5sum = 6b372e744ef56fcb59179f7e16a7af7b
prefix = ${buildout:parts-directory}/opt
configure-options =
    --with-libevent=${libevent:prefix}
environment = 
    LDFLAGS=-Wl,-rpath,${buildout:parts-directory}/opt/lib
    CFLAGS=-fno-strict-aliasing

[libmemcached]
recipe = hexagonit.recipe.cmmi
url = https://launchpad.net/libmemcached/1.0/1.0.18/+download/libmemcached-1.0.18.tar.gz 
md5sum = b3958716b4e53ddc5992e6c49d97e819
prefix = ${memcached:prefix}
configure-options =
    --without-memcached
# patch for x-platform; fix sloppy pointer comparison that fails on
# OSX / XCode 5.1 / clang (should work on all platforms), see:
# https://bugs.launchpad.net/libmemcached/+bug/1245562
patches = 
    ${buildout:directory}/src/build/libmemcached-1.0.18_osx-fix.diff
patch-options = 
    -p1

[pylibmc]
recipe = zc.recipe.egg:custom
egg = pylibmc
include-dirs = ${libmemcached:prefix}/include
library-dirs = ${libmemcached:prefix}/lib
rpath = ${libmemcached:prefix}/lib


